<template name="complete">
    <div class="lea-complete-container" id="lea-complete-print-root">

        {{#onComplete complete=loadComplete}}
            {{#container class="lea-unit-nav-container"}}
                {{> navbar navbarData}}
            {{/container}}
        {{/onComplete}}

        {{#if showThanks}}
            {{#container class="d-print-none"}}
                <div class="card my-4">
                    <div class="card-body">
                        {{#onComplete complete=loadComplete}}
                            {{> textGroup tts="pages.complete.thankYou"
                                    label=(i18n "pages.complete.thankYou")
                                    type=currentType}}
                        {{/onComplete}}
                    </div>
                </div>
            {{/container}}
        {{/if}}

        {{!-- we display a failed state container to indicate to get feedback at a later point --}}
        {{#if failed}}
            {{#container}}
                <div class="card my-4">
                    <div class="card-body">
                        {{#onComplete complete=loadComplete}}
                            {{> textGroup tts="pages.complete.failed"
                                    label=(i18n "pages.complete.failed")
                                    type=currentType}}
                        {{/onComplete}}

                    </div>
                </div>

                <div class="card-body">
                    {{#onComplete complete=loadComplete}}
                        {{> actionButton tts="common.toOverview"
                                label=(i18n "common.toOverview")
                                type=currentType
                                block=true
                                btnClass="lea-to-overview-button"}}
                    {{/onComplete}}
                </div>
            {{/container}}
        {{/if}}

        {{#if showResults}}
            {{#onComplete complete=loadComplete}}
            {{! ============================================================ }}
            {{! ALPHA LEVELS }}
            {{! ============================================================ }}
                {{#container}}
                    <div class="card my-4">
                        <div class="card-header">
                            <h5 class="card-title">{{i18n
                                    "pages.complete.alphaLevels"}}</h5>
                            {{#if isDebugUser}}
                                <span>
                                {{i18n "thresholds.min"}}
                                    : {{minCountAlphaLevel}}
                            </span>
                            {{/if}}
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col">
                                        {{i18n "common.description"}}
                                    </th>
                                    <th scope="col" class="d-print-none w-25"></th>
                                    {{#if isDebugUser}}
                                        <th scope="col"
                                            class="text-center d-none d-md-table-cell d-print-table-cell">
                                            {{i18n "thresholds.count"}}
                                        </th>
                                        <th scope="col"
                                            class="text-center d-none d-md-table-cell d-print-table-cell">
                                            {{i18n "thresholds.correct"}}
                                        </th>
                                        <th scope="col"
                                            class="text-center d-none d-md-table-cell d-print-table-cell">
                                            {{i18n "thresholds.perc"}}
                                        </th>
                                    {{/if}}
                                    <th scope="col" class="text-center">
                                        {{i18n "thresholds.grade"}}
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                {{#each alphaLevel in alphaLevels}}
                                    <tr class="{{#unless alphaLevel.isGraded}}text-muted{{/unless}}">
                                        <td class="text-center">{{alphaLevel.shortCode}}</td>
                                        <td>{{alphaLevel.description}}</td>
                                        <td class="d-print-none align-middle">
                                            {{#if alphaLevel.isGraded}}
                                                <div class="progress border-{{currentType}} border"
                                                     style="height: 0.75rem;">
                                                    <div class="progress-bar bg-{{currentType}}"
                                                         role="progressbar"
                                                         style="width: {{alphaLevel.perc}}%;"
                                                         aria-valuenow="{{alphaLevel.perc}}"
                                                         aria-valuemin="0"
                                                         aria-valuemax="100">
                                                    </div>
                                                </div>
                                            {{/if}}
                                        </td>
                                        {{#if isDebugUser}}
                                            <td class="text-center d-none d-md-table-cell d-print-table-cell">{{alphaLevel.count}}</td>
                                            <td class="text-center d-none d-md-table-cell d-print-table-cell">{{alphaLevel.scored}}</td>
                                            <td class="text-center d-none d-md-table-cell d-print-table-cell">{{alphaLevel.perc}}</td>
                                        {{/if}}
                                        <td class="text-center no-wrap">
                                            {{> textGroup text=(i18n alphaLevel.gradeLabel)}}
                                        </td>
                                    </tr>
                                {{else}}
                                    <tr>
                                        <th scope="row">{{>loading}}</th>
                                        <td>{{>loading}}</td>
                                        <td>{{>loading}}</td>
                                        <td>{{>loading}}</td>
                                        <td>{{>loading}}</td>
                                    </tr>
                                {{/each}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                {{/container}}

            {{! ============================================================ }}
            {{! COMPETENCIES }}
            {{! ============================================================ }}
                {{#container}}
                    <div class="card my-4">
                        <div class="card-header">
                            <h5 class="card-title">{{i18n
                                    "pages.complete.competencies"}}</h5>
                            {{#if isDebugUser}}
                                <span>
                                {{i18n "thresholds.min"}}
                                    : {{minCountCompetency}}
                            </span>
                            {{/if}}
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col">
                                        {{i18n "common.description"}}
                                    </th>
                                    <th scope="col" class="d-print-none w-25"></th>
                                    {{#if isDebugUser}}
                                        <th scope="col"
                                            class="text-center d-none d-md-table-cell d-print-table-cell">
                                            {{i18n "thresholds.count"}}
                                        </th>
                                        <th scope="col"
                                            class="text-center d-none d-md-table-cell d-print-table-cell">
                                            {{i18n "thresholds.correct"}}
                                        </th>
                                        <th scope="col"
                                            class="text-center d-none d-md-table-cell d-print-table-cell">
                                            {{i18n "thresholds.perc"}}
                                        </th>
                                    {{/if}}
                                    <th scope="col" class="text-center">
                                        {{i18n "thresholds.grade"}}
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                {{#each competency in competencies}}
                                    <tr class="{{#unless competency.isGraded}}text-muted{{/unless}}">
                                        <td class="text-center">{{competency.shortCode}}</td>
                                        <td>{{competency.description}}</td>
                                        <td class="d-print-none align-middle">
                                            {{#if competency.isGraded}}
                                                <div class="progress border-{{currentType}} border"
                                                     style="height: 0.75rem;">
                                                    <div class="progress-bar bg-{{currentType}}"
                                                         role="progressbar"
                                                         style="width: {{competency.perc}}%;"
                                                         aria-valuenow="{{competency.perc}}"
                                                         aria-valuemin="0"
                                                         aria-valuemax="100">
                                                    </div>
                                                </div>
                                            {{/if}}
                                        </td>
                                        {{#if isDebugUser}}
                                            <td class="text-center d-none d-md-table-cell d-print-table-cell">{{competency.count}}</td>
                                            <td class="text-center d-none d-md-table-cell d-print-table-cell">{{competency.scored}}</td>
                                            <td class="text-center d-none d-md-table-cell d-print-table-cell">{{competency.perc}}</td>
                                        {{/if}}
                                        <td class="text-center no-wrap">
                                            {{> textGroup text=(i18n competency.gradeLabel)}}
                                        </td>
                                    </tr>
                                {{else}}
                                    <tr>
                                        <th scope="row">{{>loading}}</th>
                                        <td>{{>loading}}</td>
                                        <td>{{>loading}}</td>
                                        <td>{{>loading}}</td>
                                        <td>{{>loading}}</td>
                                    </tr>
                                {{/each}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                {{/container}}
            {{/onComplete}}

            {{! ============================================================ }}
            {{! RESPONSES (DEBUG-ONLY) }}
            {{! ============================================================ }}

            {{#if isDebugUser}}
                {{#container}}
                    <div class="card my-4">
                        <div class="card-header">
                            <h5 class="card-title">
                                {{i18n "pages.complete.responses"}}
                            </h5>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th scope="col">Unit</th>
                                    <th scope="col">page</th>
                                    <th scope="col">responses</th>
                                    <th scope="col">scores</th>
                                </tr>
                                </thead>
                                <tbody>
                                {{#each response in responses}}
                                    <tr scope="row">
                                        <td>{{response.unit.shortCode}}</td>
                                        <td>{{response.page}}</td>
                                        <td>
                                            <pre><code>{{stringify response.responses}}</code></pre>
                                        </td>
                                        <td>
                                            {{#each entry in response.scores}}
                                                    {{#each competencyId in entry.competency}}
                                                    <span class="rounded border border-1 p-3 bg-{{#if isScored entry.score}}success{{else}}danger{{/if}} text-white">
                                                        {{#with getCompetency competencyId}}{{this.shortCode}}{{/with}}
                                                    </span>
                                                    {{/each}}
                                            {{/each}}
                                        </td>
                                    </tr>
                                {{/each}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                {{/container}}
            {{/if}}

            {{!-- iterate all possible feedback levels
            {{#container}}


                {{#with feedbackLevels}}
                    {{#each feedbackLevel in this}}

                    {{! only display category if there are any competencies related }}
                        {{#with (getCompetencies @index)}}
                            <ul class="card list-group my-4">
                                <li class="list-group-item font-weight-bold d-flex">
                                    {{> textGroup text=feedbackLevel.description
                                            label=feedbackLevel.description
                                            groupClass="w-100"
                                            type=currentType}}
                                    {{> icon fw=true far=true name=feedbackLevel.icon scale=2}}
                                </li>




                                {{#each competencyId in this}}
                                    <li class="list-group-item">
                                        {{#let competency=(getCompetency competencyId)}}
                                            {{> textGroup text=competency.description
                                                    label=competency.description
                                                    groupClass="w-100"
                                                    type=currentType}}
                                            {{#if competency.example}}
                                                {{> textGroup text=competency.example
                                                        label=competency.example
                                                        groupClass="w-100"
                                                        type=currentType}}
                                            {{/if}}
                                        {{/let}}
                                    </li>
                                {{/each}}
                            </ul>
                        {{/with}}
                    {{/each}}
                {{/with}}
            {{/container}}
                --}}

            {{#container class="d-print-none"}}
                <div class="card lea-complete-showprint-container ">
                    <div class="card-body font-weight-bold">
                        {{> textGroup tts="pages.complete.youCanPrint" type=currentType}}
                    </div>
                    <div class="card-body">
                        {{#textGroup tts="pages.complete.printResults"
                                     groupClass="w-100"
                                     label=(i18n "pages.complete.printResults")
                                     type=currentType}}
                            {{> actionButton
                                    tts="actions.print"
                                    type=currentType
                                    outline=true
                                    class="ml-auto print-simple"
                                    icon="print"}}
                        {{/textGroup}}
                    </div>
                </div>

                <div class="card-body">
                    {{> actionButton tts="common.forward" label=(i18n "common.forward") block=true btnClass="lea-showresults-forward-button" class="ml-auto" type=currentType}}
                </div>
            {{/container}}
        {{/if}}

        {{#if showDecision}}
            {{#container class="d-print-none"}}
                <div class="card lea-complete-showprint-container">
                    <div class="card-body">
                        {{#with currentType}}
                            {{> textGroup tts="pages.complete.continueOrEnd" type=this }}
                        {{/with}}
                    </div>
                </div>

                <div class="card-body d-flex justify-content-between">
                    {{> actionButton tts="common.back" label=(i18n "common.back") type=currentType
                            btnClass="lea-showdecision-back-button" outline=true}}
                    {{> actionButton tts="common.end" label=(i18n "common.end") type=currentType
                            btnClass="lea-end-button" outline=true}}
                    {{> actionButton tts="actions.continue" label=(i18n "actions.continue") type=currentType
                            btnClass="lea-continue-button"}}
                </div>
            {{/container}}
        {{/if}}
    </div>
</template>