<template name="complete">
    <div class="lea-complete-container" id="lea-complete-print-root">

        {{#onComplete complete=loadComplete}}
            {{#container class="lea-unit-nav-container"}}
                {{> navbar navbarData}}
            {{/container}}
        {{/onComplete}}

        {{#if showThanks}}
            {{#container class="d-print-none"}}
                <div class="card my-4">
                    <div class="card-body">
                        {{#onComplete complete=loadComplete}}
                            {{> textGroup tts="pages.complete.thankYou"
                                    label=(i18n "pages.complete.thankYou")
                                    type=currentType}}
                        {{/onComplete}}
                    </div>
                </div>
            {{/container}}
        {{/if}}

        {{!-- we display a failed state container to indicate to get feedback at a later point --}}
        {{#if failed}}
            {{#container}}
                <div class="card my-4">
                    <div class="card-body">
                        {{#onComplete complete=loadComplete}}
                            {{> textGroup tts="pages.complete.failed"
                                    label=(i18n "pages.complete.failed")
                                    type=currentType}}
                        {{/onComplete}}

                    </div>
                </div>

                <div class="card-body">
                    {{#onComplete complete=loadComplete}}
                        {{> actionButton tts="common.toOverview"
                                label=(i18n "common.toOverview")
                                type=currentType
                                block=true
                                btnClass="lea-to-overview-button"}}
                    {{/onComplete}}
                </div>
            {{/container}}
        {{/if}}

        {{#if showResults}}
            {{#onComplete complete=loadComplete}}
            {{#if isDebugUser}}
                {{#container}}
                    <div class="card my-4">
                        <div class="card-header">
                            <h5 class="card-title">{{i18n "pages.complete.competencies"}}</h5>
                            <span>
                                {{i18n "thresholds.min"}}: {{minCountCompetency}}
                            </span>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th scope="col" class="text-center">#</th>
                                    <th scope="col" class="text-center">
                                        {{i18n "thresholds.id"}}
                                    </th>
                                    <th scope="col" class=" d-print-none"></th>
                                    <th scope="col" class="text-center d-none d-md-table-cell d-print-table-cell">
                                        {{i18n "thresholds.count"}}
                                    </th>
                                    <th scope="col" class="text-center d-none d-md-table-cell d-print-table-cell">
                                        {{i18n "thresholds.correct"}}
                                    </th>
                                    <th scope="col" class="text-center d-none d-md-table-cell d-print-table-cell">
                                        {{i18n "thresholds.perc"}}
                                    </th>
                                    <th scope="col" class="text-center">
                                        {{i18n "thresholds.grade"}}
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                {{#each competency in competencies}}
                                    <tr class="{{#unless competency.isGraded}}text-muted{{/unless}}">
                                        <th scope="row" class="text-center">{{@index}}</th>
                                        <td class="text-center">{{competency.shortCode}}</td>
                                        <td class="w-25 align-middle d-print-none">
                                            {{#if competency.isGraded}}
                                            <div class="progress border-{{currentType}} border" style="height: 0.75rem;">
                                                <div class="progress-bar bg-{{currentType}}"
                                                     role="progressbar"
                                                     style="width: {{competency.perc}}%;"
                                                     aria-valuenow="{{competency.perc}}"
                                                     aria-valuemin="0"
                                                     aria-valuemax="100">
                                                </div>
                                            </div>
                                            {{/if}}
                                        </td>
                                        <td class="text-center d-none d-md-table-cell d-print-table-cell">{{competency.limit}}</td>
                                        <td class="text-center d-none d-md-table-cell d-print-table-cell">{{competency.count}}</td>
                                        <td class="text-center d-none d-md-table-cell d-print-table-cell    ">{{competency.perc}}</td>
                                        <td class="text-center">{{i18n competency.grade.label}}</td>
                                    </tr>
                                    {{else}}
                                    <tr>
                                        <th scope="row">{{>loading}}</th>
                                        <td>{{>loading}}</td>
                                        <td>{{>loading}}</td>
                                        <td>{{>loading}}</td>
                                        <td>{{>loading}}</td>
                                    </tr>
                                {{/each}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                {{/container}}
            {{/if}}
            {{/onComplete}}

            {{!-- iterate all possible feedback levels
            {{#container}}


                {{#with feedbackLevels}}
                    {{#each feedbackLevel in this}}

                    {{! only display category if there are any competencies related }}
                        {{#with (getCompetencies @index)}}
                            <ul class="card list-group my-4">
                                <li class="list-group-item font-weight-bold d-flex">
                                    {{> textGroup text=feedbackLevel.description
                                            label=feedbackLevel.description
                                            groupClass="w-100"
                                            type=currentType}}
                                    {{> icon fw=true far=true name=feedbackLevel.icon scale=2}}
                                </li>




                                {{#each competencyId in this}}
                                    <li class="list-group-item">
                                        {{#let competency=(getCompetency competencyId)}}
                                            {{> textGroup text=competency.description
                                                    label=competency.description
                                                    groupClass="w-100"
                                                    type=currentType}}
                                            {{#if competency.example}}
                                                {{> textGroup text=competency.example
                                                        label=competency.example
                                                        groupClass="w-100"
                                                        type=currentType}}
                                            {{/if}}
                                        {{/let}}
                                    </li>
                                {{/each}}
                            </ul>
                        {{/with}}
                    {{/each}}
                {{/with}}
            {{/container}}
                --}}

            {{#container class="d-print-none"}}
                <div class="card lea-complete-showprint-container ">
                    <div class="card-body font-weight-bold">
                        {{> textGroup tts="pages.complete.youCanPrint" type=currentType}}
                    </div>
                    <div class="card-body">
                        {{#textGroup tts="pages.complete.printResults"
                                     groupClass="w-100"
                                     label=(i18n "pages.complete.printResults")
                                     type=currentType}}
                            <button class="ml-auto btn btn-lg btn-outline-{{currentType}} print-simple">
                                <i class="fa fas fa-fw fa-print"></i>
                            </button>
                        {{/textGroup}}
                    </div>
                </div>

                <div class="card-body">
                    {{> actionButton tts="common.forward" label=(i18n "common.forward") block=true btnClass="lea-showresults-forward-button" class="ml-auto" type=currentType}}
                </div>
            {{/container}}
        {{/if}}

        {{#if showDecision}}
            {{#container class="d-print-none"}}
                <div class="card lea-complete-showprint-container">
                    <div class="card-body">
                        {{#with currentType}}
                            {{> textGroup tts="pages.complete.continueOrEnd" type=this }}
                        {{/with}}
                    </div>
                </div>

                <div class="card-body d-flex justify-content-between">
                    {{> actionButton tts="common.back" label=(i18n "common.back") type=currentType
                            btnClass="lea-showdecision-back-button" outline=true}}
                    {{> actionButton tts="common.end" label=(i18n "common.end") type=currentType
                            btnClass="lea-end-button" outline=true}}
                    {{> actionButton tts="actions.continue" label=(i18n "actions.continue") type=currentType
                            btnClass="lea-continue-button"}}
                </div>
            {{/container}}
        {{/if}}
    </div>
</template>